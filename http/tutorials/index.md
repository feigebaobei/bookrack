# HTTP 概述

能够获取html等的网络资源的协议。一个完整的web文档通常由多个不同的子文档组成。如：文本、css、图片等。

使用浏览器（等）发出的消息叫requests、由服务器响应的消息叫responses.

```

|------------------------------------------------------------------------|
|                  |                   |                                 |
|                  |                   |         web apis                |
|                  |                   |                                 |
|     HTML         |        CSS        |---------------------------------|
|                  |                   |                                 |
|                  |                   |         javascript              |
|                  |                   |                                 |
|------------------------------------------------------------------------|
|                                                                        |
|                               HTTP                                     |
|                                                                        |
|------------------------------------------------------------------------|
|    DNS      |                            |             TLS             |
|-------------|                            |-----------------------------|
|    UDP      |                           TCP                            |
|------------------------------------------------------------------------|
|                                   IP                                   |
|------------------------------------------------------------------------|
```

## 基于http的组件系统

一般来说最简单的形式是：客户端-服务器。由一个客户端和一个服务器组成。实际情况比较这个复杂。多了一些代理等。

```
client<------>proxy<------>proxy<----->server
```



### 客户端user-agent

### web服务器

### 代理（Proxies)

- 缓存
- 过滤
- 负载均衡
- 认证
- 日志记录

## http的基本性质

1. 简单。
2. 可扩展。
3. 无状态，有会话的。每次http传输都无状态的，但是可以在http的头部使用cookie来标明状态。也就是说可以有状态。
4. http/1.0有2个缺点：打开一个tcp连接需要多次往返消息传递（不知道是不是说的三次握手四次挥手），因此速度慢。若多个消息周期性发送时则会高效。暖连接比冷连接高效。google研发了一种以udp为基础的高效传输协议[quic](<https://en.wikipedia.org/wiki/QUIC>)

## http能控制什么

1. 在浏览器中缓存一些数据。给代理发送使用缓存中数据的命令。
2. 开发同源限制。为了保护网页的安全。浏览器强制对非同源的请求限制。
3. 一些网页、数据需要认证后能才访问。
4. 代理和隧道
5. 在http头部设置cookie，使该次请求成为有状态。服务器会根据状态，做出回应。

## http流

需要经过以下4步。

1. 打开一个tcp连接、或重用一个已经存在的连接。tcp连接可以一次打开一条或多条请求。

2. 发送一个http报文。在http2中这些消息被封装在帧中。

   ```
   GET / HTTP /1.1
   Host: developer.mozilla.org
   Accept-Language: fr
   ```

3. 读取服务端返回的报文消息。

   ```
   HTTP/1.1 200 OK
   Date: Sat, 09 Oct 2010 14:28:02 GMT
   Server: Apache
   Last-Modified: Tue, 01 Dec 2009 20:18:22 GMT
   ETag: "51142bc1-7449-479b075b2891b"
   Accept-Ranges: bytes
   Content-Length: 29769
   Content-Type: text/html
   
   <!DOCTYPE html... (here comes the 29769 bytes of the requested web page)
   ```

4. 关闭此连接或为后续请求重用连接。

## http报文

现在有2种http协议：http/1.1 http/2.在http2中把报文嵌入到了一个新的二进制结构，帧。帧实现了很多优化。

有2种报文类型。请求，响应。

#### 请求

![A basic HTTP request](https://mdn.mozillademos.org/files/13687/HTTP_Request.png)

- 指明使用哪种方式请求。
- 指明资源的路径。
- 指明http协议版本号。
- 为服务端表达其它信息的可靠头部headers.它里面的内容可以任何修改。
- 对于一些像post这样的方法，报文的body就包含了发送的资源，这与响应报文的body类似。

#### 响应

![img](https://mdn.mozillademos.org/files/13691/HTTP_Response.png)

- http的版本号。
- 状态码。
- 状态消息。
- headers头部信息。
- 可选项，比起请求报文，响应报文中更常见地包含获取的资源body.

## 总结

http是一种简单的可扩展的协议。可扩展性表现在可以轻松扩展头部信息。

